name: CI/CD Pipeline

on:
  push:
    branches:
      - main  # Trigger on push to 'main' branch

jobs:
  build_and_scan:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout code
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Step 2: SonarCloud Scan
      - name: SonarCloud Scan
        uses: sonarsource/sonarcloud-github-action@v3.1.0  
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

      # Step 3: Set up Go environment
      - name: Set up Go environment
        uses: actions/setup-go@v5
        with:
          go-version: '1.23.2'

      # Step 4: Build the application
      - name: Build the application
        run: go build -o artifact.zip main.go

      # Step 5: Upload build artifacts
      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: artifacts
          path: artifact.zip
          
      - name: List files
        run: pwd && ls -la

 
